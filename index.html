<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grouping Hypothesis Template Guide</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        h1 {
            color: #333;
        }
        input[type="text"], textarea, input[type="button"] {
            padding: 10px;
            margin-top: 10px;
            width: 100%;
            box-sizing: border-box;
        }
        #output {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
            background-color: #fff;
        }
        .section {
            margin-bottom: 20px;
        }
        .download-btn {
            margin-top: 20px;
            display: none; /* Hidden until template is generated */
        }
        .error {
            color: red;
            margin-top: 10px;
        }
    </style>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>

    <h1>Grouping Hypothesis Template Guide</h1>
    <p>Follow the steps below to create your grouping hypothesis template.</p>

    <div class="section">
        <h2>1. Hypothesis Statement</h2>
        <textarea id="hypothesisInput" placeholder="Enter your hypothesis statement here..."></textarea>
    </div>

    <div class="section">
        <h2>2. Purpose</h2>
        <textarea id="criteriaInput" placeholder="Mechanistic, Precautionary, Regulatory, Safety by Design, Targeted testing..."></textarea>
    </div>

    <div class="section">
        <h2>3. Exposure Context</h2>
        <textarea id="rationaleInput" placeholder="Occupational, Consumer, Environmental..."></textarea>
    </div>

    <div class="section">
        <h2>4. Input from Life Cycle</h2>
        <textarea id="outcomesInput" placeholder="Physical form, Stability, Exposure, Intended Use, etc..."></textarea>
    </div>

    <input type="button" value="Generate Template" onclick="generateTemplate()">
    <input type="button" id="downloadBtn" class="download-btn" value="Download Template as Image" onclick="downloadTemplate()">
    <input type="button" value="View Data" onclick="viewData()">

    <div id="output"></div>
    <div id="error" class="error"></div> <!-- Error message display -->

    <script>
        function generateTemplate() {
            const hypothesis = document.getElementById("hypothesisInput").value.trim();
            const criteria = document.getElementById("criteriaInput").value.trim();
            const rationale = document.getElementById("rationaleInput").value.trim();
            const outcomes = document.getElementById("outcomesInput").value.trim();

            // Create an entry object
            const entry = {
                hypothesis: hypothesis || 'Not provided',
                criteria: criteria || 'Not provided',
                rationale: rationale || 'Not provided',
                outcomes: outcomes || 'Not provided'
            };

            // Get existing entries from local storage or initialize an empty array
            const existingEntries = JSON.parse(localStorage.getItem('entries')) || [];

            // Check for duplicates
            const isDuplicate = existingEntries.some(existingEntry => 
                existingEntry.hypothesis === entry.hypothesis &&
                existingEntry.criteria === entry.criteria &&
                existingEntry.rationale === entry.rationale &&
                existingEntry.outcomes === entry.outcomes
            );

            // If duplicate, show error message
            if (isDuplicate) {
                document.getElementById("error").innerText = 'Entry already exists.';
                return; // Exit the function if there's a duplicate
            } else {
                document.getElementById("error").innerText = ''; // Clear error message
            }

            // Add the new entry to the array
            existingEntries.push(entry);
            // Save back to local storage
            localStorage.setItem('entries', JSON.stringify(existingEntries));

            // Display the output
            displayOutput(entry);
        }

        function displayOutput(entry) {
            let output = '<h2>Your Grouping Hypothesis Template</h2>';
            output += `<strong>Hypothesis Statement:</strong><br>${entry.hypothesis}<br><br>`;
            output += `<strong>Purpose:</strong><br>${entry.criteria}<br><br>`;
            output += `<strong>Exposure Context:</strong><br>${entry.rationale}<br><br>`;
            output += `<strong>Input from Life Cycle:</strong><br>${entry.outcomes}`;

            document.getElementById("output").innerHTML = output;

            // Show the download button
            document.getElementById("downloadBtn").style.display = "inline-block";
        }

        function viewData() {
            window.location.href = 'data.html'; // Redirect to the data page
        }

        function downloadTemplate() {
            html2canvas(document.getElementById("output")).then(canvas => {
                const imgData = canvas.toDataURL("image/png");
                const link = document.createElement('a');
                link.href = imgData;
                link.download = 'grouping_hypothesis_template.png';
                link.click();
            });
        }
    </script>

</body>
</html>
